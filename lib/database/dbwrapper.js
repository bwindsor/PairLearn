"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const db_host = process.env.DB_HOST;
const db_port = process.env.DB_PORT;
const db_username = process.env.DB_USER;
const db_password = process.env.DB_PASS;
const http = require("http");
let add_user = (username, password, done, existing_user) => {
    // An object of options to indicate where to post to
    let post_data = {
        name: username,
        password: password,
        roles: [],
        type: 'user'
    };
    if (existing_user) {
        post_data._rev = existing_user._rev;
    }
    post_data.name = username;
    post_data.password = password;
    post_data.roles = [];
    post_data.type = 'user';
    if (existing_user) {
        post_data._rev = existing_user._rev;
    }
    var base64encodedData = new Buffer(db_username + ':' + db_password).toString('base64');
    var post_options;
    post_options = {
        host: db_host,
        port: db_port,
        path: '/_users/org.couchdb.user:' + username,
        method: 'PUT',
        headers: {
            'Authorization': 'Basic ' + base64encodedData,
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        }
    };
    // Set up the request
    var post_req = http.request(post_options, function (res) {
        var body = '';
        res.setEncoding('utf8');
        res.on('data', function (chunk) {
            body += chunk;
        });
        res.on('end', function () {
            var response = JSON.parse(body);
            if (response.ok) {
                done();
            }
            else {
                done(response);
            }
        });
    });
    post_req.write(JSON.stringify(post_data));
    post_req.end();
};
function get_user(username, done) {
    basic_method_on_user('GET', username, done);
}
function adduser(username, password, done) {
    get_user(username, (user_object, err) => {
        if (err) {
            add_user(username, password, done, null);
        }
        else {
            add_user(username, password, done, user_object);
        }
    });
}
exports.adduser = adduser;
function deleteuser(username, done) {
    basic_method_on_user('DELETE', username, done);
}
exports.deleteuser = deleteuser;
function basic_method_on_user(method_name, username, done) {
    // An object of options to indicate where to post to
    var base64encodedData = new Buffer(db_username + ':' + db_password).toString('base64');
    var get_options = {
        host: db_host,
        port: db_port,
        path: '/_users/org.couchdb.user:' + username,
        method: method_name,
        headers: {
            'Authorization': 'Basic ' + base64encodedData,
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        }
    };
    // Set up the request
    var post_req = http.request(get_options, function (res) {
        var body = '';
        res.setEncoding('utf8');
        res.on('data', function (chunk) {
            body += chunk;
        });
        res.on('end', function () {
            var response = JSON.parse(body);
            if (response.error) {
                done(null, response);
            }
            else {
                done(response);
            }
        });
    });
    post_req.end();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGJ3cmFwcGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2RhdGFiYXNlL2Rid3JhcHBlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO0FBQ3BDLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO0FBQ3BDLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO0FBQ3hDLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO0FBQ3hDLDZCQUE2QjtBQUU3QixJQUFJLFFBQVEsR0FBd0IsQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxhQUFhO0lBRXhFLG9EQUFvRDtJQUNwRCxJQUFJLFNBQVMsR0FBK0I7UUFDeEMsSUFBSSxFQUFFLFFBQVE7UUFDZCxRQUFRLEVBQUUsUUFBUTtRQUNsQixLQUFLLEVBQUUsRUFBRTtRQUNULElBQUksRUFBRSxNQUFNO0tBQ2YsQ0FBQztJQUNGLEVBQUUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFDaEIsU0FBUyxDQUFDLElBQUksR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDO0lBQ3hDLENBQUM7SUFDRCxTQUFTLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztJQUMxQixTQUFTLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztJQUM5QixTQUFTLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztJQUNyQixTQUFTLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQztJQUN4QixFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO1FBQ2hCLFNBQVMsQ0FBQyxJQUFJLEdBQUcsYUFBYSxDQUFDLElBQUksQ0FBQztJQUN4QyxDQUFDO0lBQ0QsSUFBSSxpQkFBaUIsR0FBRyxJQUFJLE1BQU0sQ0FB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RSxrQkFBa0I7U0FDckM7S0FDSixDQUFDO0lBRUYscUJBQXFCO0lBQ3JCLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLFVBQVMsR0FBRztRQUNqRCxJQUFJLElBQUksR0FBRyxFQUFFLENBQUE7UUFDYixHQUFHLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3hCLEdBQUcsQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLFVBQVUsS0FBSztZQUMxQixJQUFJLElBQUksS0FBSyxDQUFDO1FBQ2xCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsR0FBRyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUU7WUFDVixJQUFJLFFBQVEsR0FBeUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN0RCxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDakIsSUFBSSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztZQUN6QixDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ0osSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ25CLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUMsQ0FBQyxDQUFDO0lBQ0gsUUFBUSxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQ25CLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBkYl9ob3N0ID0gcHJvY2Vzcy5lbnYuREJfSE9TVDtcclxuY29uc3QgZGJfcG9ydCA9IHByb2Nlc3MuZW52LkRCX1BPUlQ7XHJcbmNvbnN0IGRiX3VzZXJuYW1lID0gcHJvY2Vzcy5lbnYuREJfVVNFUjtcclxuY29uc3QgZGJfcGFzc3dvcmQgPSBwcm9jZXNzLmVudi5EQl9QQVNTO1xyXG5pbXBvcnQgKiBhcyBodHRwIGZyb20gXCJodHRwXCI7XHJcblxyXG5sZXQgYWRkX3VzZXIgOiBkYndyYXBwZXIuYWRkX3VzZXIgPSAodXNlcm5hbWUsIHBhc3N3b3JkLCBkb25lLCBleGlzdGluZ191c2VyKSA9PiB7XHJcblxyXG4gICAgLy8gQW4gb2JqZWN0IG9mIG9wdGlvbnMgdG8gaW5kaWNhdGUgd2hlcmUgdG8gcG9zdCB0b1xyXG4gICAgbGV0IHBvc3RfZGF0YSA6IGRid3JhcHBlci5JdXNlcl9wb3N0X2RhdGEgPSB7XHJcbiAgICAgICAgbmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkLFxyXG4gICAgICAgIHJvbGVzOiBbXSxcclxuICAgICAgICB0eXBlOiAndXNlcidcclxuICAgIH07XHJcbiAgICBpZiAoZXhpc3RpbmdfdXNlcikge1xyXG4gICAgICAgIHBvc3RfZGF0YS5fcmV2ID0gZXhpc3RpbmdfdXNlci5fcmV2O1xyXG4gICAgfVxyXG4gICAgcG9zdF9kYXRhLm5hbWUgPSB1c2VybmFtZTtcclxuICAgIHBvc3RfZGF0YS5wYXNzd29yZCA9IHBhc3N3b3JkO1xyXG4gICAgcG9zdF9kYXRhLnJvbGVzID0gW107XHJcbiAgICBwb3N0X2RhdGEudHlwZSA9ICd1c2VyJztcclxuICAgIGlmIChleGlzdGluZ191c2VyKSB7XHJcbiAgICAgICAgcG9zdF9kYXRhLl9yZXYgPSBleGlzdGluZ191c2VyLl9yZXY7XHJcbiAgICB9XHJcbiAgICB2YXIgYmFzZTY0ZW5jb2RlZERhdGEgPSBuZXcgQnVmZmVyKGRiX3VzZXJuYW1lICsgJzonICsgZGJfcGFzc3dvcmQpLnRvU3RyaW5nKCdiYXNlNjQnKTtcclxuXHJcbiAgICB2YXIgcG9zdF9vcHRpb25zIDogaHR0cC5SZXF1ZXN0T3B0aW9ucztcclxuICAgIHBvc3Rfb3B0aW9ucyA9IHtcclxuICAgICAgICBob3N0OiBkYl9ob3N0LFxyXG4gICAgICAgIHBvcnQ6IGRiX3BvcnQsXHJcbiAgICAgICAgcGF0aDogJy9fdXNlcnMvb3JnLmNvdWNoZGIudXNlcjonICsgdXNlcm5hbWUsXHJcbiAgICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogJ0Jhc2ljICcgKyBiYXNlNjRlbmNvZGVkRGF0YSxcclxuICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgICAvLyBTZXQgdXAgdGhlIHJlcXVlc3RcclxuICAgIHZhciBwb3N0X3JlcSA9IGh0dHAucmVxdWVzdChwb3N0X29wdGlvbnMsIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgIHZhciBib2R5ID0gJydcclxuICAgICAgICByZXMuc2V0RW5jb2RpbmcoJ3V0ZjgnKTtcclxuICAgICAgICByZXMub24oJ2RhdGEnLCBmdW5jdGlvbiAoY2h1bmspIHtcclxuICAgICAgICAgICAgYm9keSArPSBjaHVuaztcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXMub24oJ2VuZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHJlc3BvbnNlIDogZGJ3cmFwcGVyLklyZXNwb25zZSA9IEpTT04ucGFyc2UoYm9keSk7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xyXG4gICAgICAgICAgICAgICAgZG9uZSgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZG9uZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSAgXHJcbiAgICB9KTtcclxuICAgIHBvc3RfcmVxLndyaXRlKEpTT04uc3RyaW5naWZ5KHBvc3RfZGF0YSkpO1xyXG4gICAgcG9zdF9yZXEuZW5kKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldF91c2VyKHVzZXJuYW1lLCBkb25lKSB7XHJcbiAgICBiYXNpY19tZXRob2Rfb25fdXNlcignR0VUJywgdXNlcm5hbWUsIGRvbmUpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBhZGR1c2VyKHVzZXJuYW1lOnN0cmluZywgcGFzc3dvcmQ6c3RyaW5nLCBkb25lKSB7XHJcbiAgICBnZXRfdXNlcih1c2VybmFtZSwgKHVzZXJfb2JqZWN0LCBlcnIpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGFkZF91c2VyKHVzZXJuYW1lLCBwYXNzd29yZCwgZG9uZSwgbnVsbCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYWRkX3VzZXIodXNlcm5hbWUsIHBhc3N3b3JkLCBkb25lLCB1c2VyX29iamVjdClcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBkZWxldGV1c2VyKHVzZXJuYW1lOnN0cmluZywgZG9uZSkge1xyXG4gICAgYmFzaWNfbWV0aG9kX29uX3VzZXIoJ0RFTEVURScsIHVzZXJuYW1lLCBkb25lKTtcclxufVxyXG5cclxuZnVuY3Rpb24gYmFzaWNfbWV0aG9kX29uX3VzZXIobWV0aG9kX25hbWU6IHN0cmluZywgdXNlcm5hbWU6c3RyaW5nLCBkb25lKSB7XHJcbi8vIEFuIG9iamVjdCBvZiBvcHRpb25zIHRvIGluZGljYXRlIHdoZXJlIHRvIHBvc3QgdG9cclxuICAgIHZhciBiYXNlNjRlbmNvZGVkRGF0YSA9IG5ldyBCdWZmZXIoZGJfdXNlcm5hbWUgKyAnOicgKyBkYl9wYXNzd29yZCkudG9TdHJpbmcoJ2Jhc2U2NCcpO1xyXG5cclxuICAgIHZhciBnZXRfb3B0aW9ucyA9IHtcclxuICAgICAgICBob3N0OiBkYl9ob3N0LFxyXG4gICAgICAgIHBvcnQ6IGRiX3BvcnQsXHJcbiAgICAgICAgcGF0aDogJy9fdXNlcnMvb3JnLmNvdWNoZGIudXNlcjonICsgdXNlcm5hbWUsXHJcbiAgICAgICAgbWV0aG9kOiBtZXRob2RfbmFtZSxcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogJ0Jhc2ljICcgKyBiYXNlNjRlbmNvZGVkRGF0YSxcclxuICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gU2V0IHVwIHRoZSByZXF1ZXN0XHJcbiAgICB2YXIgcG9zdF9yZXEgPSBodHRwLnJlcXVlc3QoZ2V0X29wdGlvbnMsIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgIHZhciBib2R5ID0gJydcclxuICAgICAgICByZXMuc2V0RW5jb2RpbmcoJ3V0ZjgnKTtcclxuICAgICAgICByZXMub24oJ2RhdGEnLCBmdW5jdGlvbiAoY2h1bmspIHtcclxuICAgICAgICAgICAgYm9keSArPSBjaHVuaztcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXMub24oJ2VuZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHJlc3BvbnNlIDogZGJ3cmFwcGVyLklyZXNwb25zZSA9IEpTT04ucGFyc2UoYm9keSk7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvcikge1xyXG4gICAgICAgICAgICAgICAgZG9uZShudWxsLCByZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkb25lKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pICBcclxuICAgIH0pO1xyXG4gICAgcG9zdF9yZXEuZW5kKCk7XHJcbn1cclxuXHJcbmV4cG9ydCB7YWRkdXNlciwgZGVsZXRldXNlcn07Il19