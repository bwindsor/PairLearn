"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const db_host = process.env.DB_HOST;
const db_port = process.env.DB_PORT;
const db_username = process.env.DB_USER;
const db_password = process.env.DB_PASS;
const http = require("http");
let add_user = (username, password, done, existing_user) => {
    // An object of options to indicate where to post to
    let post_data = {
        name: username,
        password: password,
        roles: [],
        type: 'user'
    };
    if (existing_user) {
        post_data._rev = existing_user._rev;
    }
    var base64encodedData = new Buffer(db_username + ':' + db_password).toString('base64');
    var post_options;
    post_options = {
        host: db_host,
        port: db_port,
        path: '/_users/org.couchdb.user:' + username,
        method: 'PUT',
        headers: {
            'Authorization': 'Basic ' + base64encodedData,
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        }
    };
    // Set up the request
    var post_req = http.request(post_options, function (res) {
        var body = '';
        res.setEncoding('utf8');
        res.on('data', function (chunk) {
            body += chunk;
        });
        res.on('end', function () {
            var response = JSON.parse(body);
            if (response.ok) {
                done();
            }
            else {
                done(response);
            }
        });
    });
    post_req.write(JSON.stringify(post_data));
    post_req.end();
};
function get_user(username, done) {
    basic_method_on_user('GET', username, done);
}
function adduser(username, password, done) {
    get_user(username, (user_object, err) => {
        if (err) {
            add_user(username, password, done, null);
        }
        else {
            add_user(username, password, done, user_object);
        }
    });
}
exports.adduser = adduser;
function deleteuser(username, done) {
    basic_method_on_user('DELETE', username, done);
}
exports.deleteuser = deleteuser;
function basic_method_on_user(method_name, username, done) {
    // An object of options to indicate where to post to
    var base64encodedData = new Buffer(db_username + ':' + db_password).toString('base64');
    var get_options = {
        host: db_host,
        port: db_port,
        path: '/_users/org.couchdb.user:' + username,
        method: method_name,
        headers: {
            'Authorization': 'Basic ' + base64encodedData,
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        }
    };
    // Set up the request
    var post_req = http.request(get_options, function (res) {
        var body = '';
        res.setEncoding('utf8');
        res.on('data', function (chunk) {
            body += chunk;
        });
        res.on('end', function () {
            var response = JSON.parse(body);
            if (response.error) {
                done(response);
            }
            else {
                done(null, response);
            }
        });
    });
    post_req.end();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGJ3cmFwcGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2RhdGFiYXNlL2Rid3JhcHBlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO0FBQ3BDLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO0FBQ3BDLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO0FBQ3hDLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO0FBQ3hDLDZCQUE2QjtBQUU3QixJQUFJLFFBQVEsR0FBd0IsQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxhQUFhO0lBRXhFLG9EQUFvRDtJQUNwRCxJQUFJLFNBQVMsR0FBK0I7UUFDeEMsSUFBSSxFQUFFLFFBQVE7UUFDZCxRQUFRLEVBQUUsUUFBUTtRQUNsQixLQUFLLEVBQUUsRUFBRTtRQUNULElBQUksRUFBRSxNQUFNO0tBQ2YsQ0FBQztJQUNGLEVBQUUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFDaEIsU0FBUyxDQUFDLElBQUksR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDO0lBQ3hDLENBQUM7SUFDRCxJQUFJLGlCQUFpQixHQUFHLElBQUksTUFBTSxDQUFDLFdBQVcsR0FBRyxHQUFHLEdBQUcsV0FBVyxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBRXZGLElBQUksWUFBa0MsQ0FBQztJQUN2QyxZQUFZLEdBQUc7UUFDWCxJQUFJLEVBQUUsT0FBTztRQUNiLElBQUksRUFBRSxPQUFPO1FBQ2IsSUFBSSxFQUFFLDJCQUEyQixHQUFHLFFBQVE7UUFDNUMsTUFBTSxFQUFFLEtBQUs7UUFDYixPQUFPLEVBQUU7WUFDTCxlQUFlLEVBQUUsUUFBUSxHQUFHLGlCQUFpQjtZ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UUFDbEIsQ0FBQyxDQUFDLENBQUM7UUFDSCxHQUFHLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRTtZQUNWLElBQUksUUFBUSxHQUF5QixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RELEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNqQixJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDbkIsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNKLElBQUksQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDekIsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFBO0lBQ04sQ0FBQyxDQUFDLENBQUM7SUFDSCxRQUFRLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDbkIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGRiX2hvc3QgPSBwcm9jZXNzLmVudi5EQl9IT1NUO1xyXG5jb25zdCBkYl9wb3J0ID0gcHJvY2Vzcy5lbnYuREJfUE9SVDtcclxuY29uc3QgZGJfdXNlcm5hbWUgPSBwcm9jZXNzLmVudi5EQl9VU0VSO1xyXG5jb25zdCBkYl9wYXNzd29yZCA9IHByb2Nlc3MuZW52LkRCX1BBU1M7XHJcbmltcG9ydCAqIGFzIGh0dHAgZnJvbSBcImh0dHBcIjtcclxuXHJcbmxldCBhZGRfdXNlciA6IGRid3JhcHBlci5hZGRfdXNlciA9ICh1c2VybmFtZSwgcGFzc3dvcmQsIGRvbmUsIGV4aXN0aW5nX3VzZXIpID0+IHtcclxuXHJcbiAgICAvLyBBbiBvYmplY3Qgb2Ygb3B0aW9ucyB0byBpbmRpY2F0ZSB3aGVyZSB0byBwb3N0IHRvXHJcbiAgICBsZXQgcG9zdF9kYXRhIDogZGJ3cmFwcGVyLkl1c2VyX3Bvc3RfZGF0YSA9IHtcclxuICAgICAgICBuYW1lOiB1c2VybmFtZSxcclxuICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsXHJcbiAgICAgICAgcm9sZXM6IFtdLFxyXG4gICAgICAgIHR5cGU6ICd1c2VyJ1xyXG4gICAgfTtcclxuICAgIGlmIChleGlzdGluZ191c2VyKSB7XHJcbiAgICAgICAgcG9zdF9kYXRhLl9yZXYgPSBleGlzdGluZ191c2VyLl9yZXY7XHJcbiAgICB9XHJcbiAgICB2YXIgYmFzZTY0ZW5jb2RlZERhdGEgPSBuZXcgQnVmZmVyKGRiX3VzZXJuYW1lICsgJzonICsgZGJfcGFzc3dvcmQpLnRvU3RyaW5nKCdiYXNlNjQnKTtcclxuXHJcbiAgICB2YXIgcG9zdF9vcHRpb25zIDogaHR0cC5SZXF1ZXN0T3B0aW9ucztcclxuICAgIHBvc3Rfb3B0aW9ucyA9IHtcclxuICAgICAgICBob3N0OiBkYl9ob3N0LFxyXG4gICAgICAgIHBvcnQ6IGRiX3BvcnQsXHJcbiAgICAgICAgcGF0aDogJy9fdXNlcnMvb3JnLmNvdWNoZGIudXNlcjonICsgdXNlcm5hbWUsXHJcbiAgICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogJ0Jhc2ljICcgKyBiYXNlNjRlbmNvZGVkRGF0YSxcclxuICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgICAvLyBTZXQgdXAgdGhlIHJlcXVlc3RcclxuICAgIHZhciBwb3N0X3JlcSA9IGh0dHAucmVxdWVzdChwb3N0X29wdGlvbnMsIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgIHZhciBib2R5ID0gJydcclxuICAgICAgICByZXMuc2V0RW5jb2RpbmcoJ3V0ZjgnKTtcclxuICAgICAgICByZXMub24oJ2RhdGEnLCBmdW5jdGlvbiAoY2h1bmspIHtcclxuICAgICAgICAgICAgYm9keSArPSBjaHVuaztcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXMub24oJ2VuZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHJlc3BvbnNlIDogZGJ3cmFwcGVyLklyZXNwb25zZSA9IEpTT04ucGFyc2UoYm9keSk7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xyXG4gICAgICAgICAgICAgICAgZG9uZSgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZG9uZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSAgXHJcbiAgICB9KTtcclxuICAgIHBvc3RfcmVxLndyaXRlKEpTT04uc3RyaW5naWZ5KHBvc3RfZGF0YSkpO1xyXG4gICAgcG9zdF9yZXEuZW5kKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldF91c2VyKHVzZXJuYW1lLCBkb25lKSB7XHJcbiAgICBiYXNpY19tZXRob2Rfb25fdXNlcignR0VUJywgdXNlcm5hbWUsIGRvbmUpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBhZGR1c2VyKHVzZXJuYW1lOnN0cmluZywgcGFzc3dvcmQ6c3RyaW5nLCBkb25lKSB7XHJcbiAgICBnZXRfdXNlcih1c2VybmFtZSwgKHVzZXJfb2JqZWN0LCBlcnIpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGFkZF91c2VyKHVzZXJuYW1lLCBwYXNzd29yZCwgZG9uZSwgbnVsbCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYWRkX3VzZXIodXNlcm5hbWUsIHBhc3N3b3JkLCBkb25lLCB1c2VyX29iamVjdClcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBkZWxldGV1c2VyKHVzZXJuYW1lOnN0cmluZywgZG9uZSkge1xyXG4gICAgYmFzaWNfbWV0aG9kX29uX3VzZXIoJ0RFTEVURScsIHVzZXJuYW1lLCBkb25lKTtcclxufVxyXG5cclxuZnVuY3Rpb24gYmFzaWNfbWV0aG9kX29uX3VzZXIobWV0aG9kX25hbWU6IHN0cmluZywgdXNlcm5hbWU6c3RyaW5nLCBkb25lKSB7XHJcbi8vIEFuIG9iamVjdCBvZiBvcHRpb25zIHRvIGluZGljYXRlIHdoZXJlIHRvIHBvc3QgdG9cclxuICAgIHZhciBiYXNlNjRlbmNvZGVkRGF0YSA9IG5ldyBCdWZmZXIoZGJfdXNlcm5hbWUgKyAnOicgKyBkYl9wYXNzd29yZCkudG9TdHJpbmcoJ2Jhc2U2NCcpO1xyXG5cclxuICAgIHZhciBnZXRfb3B0aW9ucyA9IHtcclxuICAgICAgICBob3N0OiBkYl9ob3N0LFxyXG4gICAgICAgIHBvcnQ6IGRiX3BvcnQsXHJcbiAgICAgICAgcGF0aDogJy9fdXNlcnMvb3JnLmNvdWNoZGIudXNlcjonICsgdXNlcm5hbWUsXHJcbiAgICAgICAgbWV0aG9kOiBtZXRob2RfbmFtZSxcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogJ0Jhc2ljICcgKyBiYXNlNjRlbmNvZGVkRGF0YSxcclxuICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gU2V0IHVwIHRoZSByZXF1ZXN0XHJcbiAgICB2YXIgcG9zdF9yZXEgPSBodHRwLnJlcXVlc3QoZ2V0X29wdGlvbnMsIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgIHZhciBib2R5ID0gJydcclxuICAgICAgICByZXMuc2V0RW5jb2RpbmcoJ3V0ZjgnKTtcclxuICAgICAgICByZXMub24oJ2RhdGEnLCBmdW5jdGlvbiAoY2h1bmspIHtcclxuICAgICAgICAgICAgYm9keSArPSBjaHVuaztcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXMub24oJ2VuZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHJlc3BvbnNlIDogZGJ3cmFwcGVyLklyZXNwb25zZSA9IEpTT04ucGFyc2UoYm9keSk7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvcikge1xyXG4gICAgICAgICAgICAgICAgZG9uZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkb25lKG51bGwsIHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pICBcclxuICAgIH0pO1xyXG4gICAgcG9zdF9yZXEuZW5kKCk7XHJcbn1cclxuXHJcbmV4cG9ydCB7YWRkdXNlciwgZGVsZXRldXNlcn07Il19